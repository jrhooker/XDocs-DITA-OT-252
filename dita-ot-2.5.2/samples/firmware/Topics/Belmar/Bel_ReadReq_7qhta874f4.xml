<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA 1.2 Topic//EN" "/SysSchema/dita/dtd/technicalContent/dtd/topic.dtd">
<topic xmlns:ditaarch="http://dita.oasis-open.org/architecture/2005/" base="Princeton" id="ReadReq_7qhta874f4" xml:lang="en-US">
  <title>ReadReq</title>

  <body>
    <p>The Read request reads data and metadata, if
    applicable, from the flash for the logical address indicated. Steps 11 and
    12 are only valid when a data frame spans two flash pages.</p>

    <fig id="Read_Request_Control_Flow_7rhta874f4">
      <title>Read Request Control Flow</title>

      <image href="Graphics/bel_lkp_read_request.svg" placement="break" width="5.5in"/>
    </fig>

    <table id="_7shta874f4">
      <title>Read Request Control Flow</title>

      <tgroup cols="3">
        <colspec colname="c1" colwidth="5*"/>

        <colspec colname="c2" colwidth="23*"/>

        <colspec colname="c3" colwidth="72*"/>

        <thead>
          <row>
            <entry>No.</entry>

            <entry>Message</entry>

            <entry>Description</entry>
          </row>
        </thead>

        <tbody>
          <row>
            <entry><p> <b otherprops="bold">1</b> </p></entry>

            <entry><p> <b otherprops="bold">CmdReady64</b>
            </p></entry>

            <entry><p>The Read
            command is received by one of the Data Managers.</p></entry>
          </row>

          <row>
            <entry><p> <b otherprops="bold">2</b> </p></entry>

            <entry><p> <b otherprops="bold">ReadLockReq</b>
            </p></entry>

            <entry><p>The Data
            Manager issues a read lock for the Data Frame range specified in
            the read request.</p></entry>
          </row>

          <row>
            <entry><p> <b otherprops="bold">3</b> </p></entry>

            <entry><p> <b otherprops="bold">LockCpl</b>
            </p></entry>

            <entry><p>The read lock
            is granted by the Locking Manager.</p></entry>
          </row>

          <row>
            <entry><p> <b otherprops="bold">4</b> </p></entry>

            <entry><p> <b otherprops="bold">BufferAllocCpl</b>
            </p></entry>

            <entry><p>The Data
            Manager processes buffer completions from the buffer manager and
            gets the data frame buffer address.</p></entry>
          </row>

          <row>
            <entry><p> <b otherprops="bold">5</b> </p></entry>

            <entry><p> <b otherprops="bold">BufferAlloc</b>
            </p></entry>

            <entry><p>The Data
            Manager sends bufferAlloc message to the Buffer Manager for future
            use.</p></entry>
          </row>

          <row>
            <entry><p> <b otherprops="bold">6</b> </p></entry>

            <entry><p> <b otherprops="bold">ReadReq</b>
            </p></entry>

            <entry><p>The Data
            Manager issues a flash read request to the Lookup Manager [0 or
            1].</p></entry>
          </row>

          <row>
            <entry/>

            <entry><p> <b otherprops="bold">Internal
            Operation</b> </p></entry>

            <entry><p>Upon the
            receipt of the READ_REQ_OPCODE from Data Manager, the Lookup
            Manager allocates a data frame structure and the copies logical
            address, the data frame buffer address, and outbound message queue
            to the data frame structure.</p></entry>
          </row>

          <row>
            <entry><p> <b otherprops="bold">7</b> </p></entry>

            <entry><p> <b otherprops="bold">dataNetworkMoveInAndLock</b> </p></entry>

            <entry><p>The Lookup
            Manager 0 issues a memory read and lock request to the data
            network to fetch lookup table entry</p></entry>
          </row>

          <row>
            <entry><p> <b otherprops="bold">8</b> </p></entry>

            <entry><p> <b otherprops="bold">dataNetworkCpl</b>
            </p></entry>

            <entry><p>The Lookup
            Manager receives data network completion for the read and lock
            request.</p></entry>
          </row>

          <row>
            <entry/>

            <entry/>

            <entry><p>If lock is not
            granted, go back to step 7 until lock is granted.</p></entry>
          </row>

          <row>
            <entry/>

            <entry><p> <b otherprops="bold">Internal
            Operation</b> </p></entry>

            <entry><p>Upon the
            receipt of the data network completion, the Lookup Manager checks
            if the lookup table entry contains a valid flash address. If itâ€™s
            not valid, skip to step 16 to send completion to the Data Manager.
            If the flash address is valid, the Lookup Manager will further
            check for:</p> <p>1. cacheValid - If set to 1,
            it means the data frame buffer has not been freed and the data can
            be read from the memory directly instead of the flash. If cache is
            valid, read the cache data structure to get data frame buffer
            information and send the read command completion to Data Manager
            with the data frame buffer address (skip to step 16). If set to 0,
            this means the data has to be read from flash.</p> <p>2. pageSpan - If set to 1, it means the data
            frame resides on two physical pages. The Lookup Manager will send
            two flash interface messages to get the data frame. If set to 0,
            data frame only resides on one physical page, therefore, only one
            message needs to be sent to flash interface.</p> <p>3. multiPlane - This bit is only valid if
            pageSpan is set to 1. If multiPlane is set to 1, it means the read
            to two physical pages can be done using a multi-plane operation.
            If set to 0, the operation has to be done using a single-plane
            operation. </p></entry>
          </row>

          <row>
            <entry><p> <b otherprops="bold">9</b> </p></entry>

            <entry><p> <b otherprops="bold">FlashRead</b>
            </p></entry>

            <entry><p>The Lookup
            Manager 0 issues a flash read request to the Flash
            Interface.</p></entry>
          </row>

          <row>
            <entry><p> <b otherprops="bold">10</b> </p></entry>

            <entry><p> <b otherprops="bold">FlashOpCpl</b>
            </p></entry>

            <entry><p>The Flash
            Interface responds to the flash read request.</p></entry>
          </row>

          <row>
            <entry/>

            <entry/>

            <entry><p>Steps 11 and
            12 are valid only when a data frame spans two flash pages in a
            single-plane operation.</p></entry>
          </row>

          <row>
            <entry><p> <b otherprops="bold">11</b> </p></entry>

            <entry><p> <b otherprops="bold">FlashRead </b>
            </p></entry>

            <entry><p>In the case
            where data frame spans two physical pages, the Lookup Manager
            issues another flash read request to the Flash
            interface.</p></entry>
          </row>

          <row>
            <entry><p> <b otherprops="bold">12</b> </p></entry>

            <entry><p> <b otherprops="bold">FlashOpCpl</b>
            </p></entry>

            <entry><p>The Flash
            Interface responds to the flash read request.</p></entry>
          </row>

          <row>
            <entry><p> <b otherprops="bold">13</b> </p></entry>

            <entry><p> <b otherprops="bold">garbageCollectErrorBlock</b> </p></entry>

            <entry><p>If flash
            interface reports read uncorrectable error, the Lookup Manager
            issues a garbage collect error block to Wearleveling
            Manager.</p></entry>
          </row>

          <row>
            <entry><p> <b otherprops="bold">14</b> </p></entry>

            <entry><p> <b otherprops="bold">ReadCpl</b>
            </p></entry>

            <entry><p>The Lookup
            Manager 0 sends a read completion to the Data Manager.</p></entry>
          </row>

          <row>
            <entry><p> <b otherprops="bold">15</b> </p></entry>

            <entry><p> <b otherprops="bold">EgressSectorDMA</b>
            </p></entry>

            <entry><p>The Data
            Manager issues egress DMA requests to transfer the data from the
            Data Frame buffer to host memory.</p></entry>
          </row>

          <row>
            <entry><p> <b otherprops="bold">16</b> </p></entry>

            <entry><p> <b otherprops="bold">DMACpl</b>
            </p></entry>

            <entry><p>The egress DMA
            responds to egress DMA requests when the data has been transferred
            to host memory.</p></entry>
          </row>

          <row>
            <entry><p> <b otherprops="bold">17</b> </p></entry>

            <entry><p> <b otherprops="bold">LockRelease</b>
            </p></entry>

            <entry><p>When all Data
            Frames have been transferred, the Data Manager releases the LBA
            range lock.</p></entry>
          </row>

          <row>
            <entry><p> <b otherprops="bold">18</b> </p></entry>

            <entry><p> <b otherprops="bold">CplQueueUpdate</b>
            </p></entry>

            <entry><p>The Admin
            Command Manager sends a completion queue update request to the
            Completion Manager.</p></entry>
          </row>

          <row>
            <entry><p> <b otherprops="bold">19</b> </p></entry>

            <entry><p> <b otherprops="bold">CplQueueUpdateCpl</b>
            </p></entry>

            <entry><p>The Completion
            Manager replies back to the Admin Command Manager when the
            completion has been successfully sent to the host.</p></entry>
          </row>

          <row>
            <entry><p> <b otherprops="bold">20</b> </p></entry>

            <entry><p> <b otherprops="bold">BufferFree</b>
            </p></entry>

            <entry><p>When they are
            no longer needed, the Data Manager frees the Data Frame
            buffers.</p></entry>
          </row>
        </tbody>
      </tgroup>
    </table>
  </body>
</topic>