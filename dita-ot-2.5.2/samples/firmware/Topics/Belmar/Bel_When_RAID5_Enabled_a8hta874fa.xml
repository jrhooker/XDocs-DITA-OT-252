<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA 1.2 Topic//EN" "/SysSchema/dita/dtd/technicalContent/dtd/topic.dtd">
<topic xmlns:ditaarch="http://dita.oasis-open.org/architecture/2005/" base="Princeton" id="When_RAID5_Enabled_a8hta874fa" xml:lang="en-US">
  <title>When RAID5 Enabled</title>

  <body>
    <fig id="Physical_Address_Assignment_when_RAID5_E_a9hta874fa">
      <title>Physical Address Assignment when RAID5
      Enabled</title>

      <image href="../../Graphics/Lookup_Mgr/Write_Flow_RAID_Enabled.svg" placement="break" width="5.5in"/>
    </fig>

    <p>As shown in <xref href="#When_RAID5_Enabled_a8hta874fa/Physical_Address_Assignment_when_RAID5_E_a9hta874fa"/>,
    When RAID5 is enabled, a physical address is assigned to XOR pages in
    addition to host data.</p>

    <section id="Getting_Flash_Addresses_aahta874fa"><title>Getting Flash Addresses</title> <ol>
        <li id="d1e9856"><p>When power
        request (with device enable state) is received, Lookup Manager (Lookup
        Manager0 and Lookup Manager1) sends block open request for all RAID
        stripes (that is, all logical targets in RAID stripe).</p></li>

        <li id="d1e9862"><p>Upon
        receiving block open completion, mark RAID stripe status to
        IDLE.</p></li>

        <li id="d1e9868"><p>Set active
        RAID stripe to zero and active logical target in stripe to first
        target of RAID stripe.</p></li>
      </ol></section>

    <section id="Processing_Inbound_Write_Requests_abhta874fa"><title>Processing Inbound Write Requests</title> <ol>
        <li id="d1e9883"><p>Check
        active RAID stripe status.</p> <p>If the active
        RAID stripe is not IDLE or the page number is equal to max page number
        of flash block, find next RAID stripe that is IDLE. If there are no
        RAID stripes in IDLE state, add a data frame write request to the
        pending list.The pending list is processed upon receiving block open
        completions.</p></li>

        <li id="d1e9892"><p>Assign RAID
        stripe-&gt;active logical target flash address to the data
        frame.</p></li>

        <li id="d1e9898"><p>If it is
        first data frame of page frame:</p> <ul>
            <li id="d1e9905"><p>Check
            inbound queue status.</p></li>

            <li id="d1e9911"><p>If
            there are no inbound write requests, enable timer. Refer section
            10.6.2.4 for sequence of operations performed when timer is
            expired.</p></li>
          </ul></li>

        <li id="d1e9919"><p>If it is
        second data frame of page frame:</p> <ul>
            <li id="d1e9926"><p>Disable
            timer if it is active</p></li>

            <li id="d1e9932"><p>Send
            page frame write request to the Write Manager.</p></li>

            <li id="d1e9938"><p>Increment RAID stripe pending
            completions.</p></li>

            <li id="d1e9944"><p>Increment page number.</p></li>

            <li id="d1e9950"><p>Set
            data frame number to zero.</p></li>

            <li id="d1e9957"><p>Update
            RAID stripe active logical target to next logical target.</p></li>
          </ul></li>

        <li id="d1e9965"><p>Increment
        number of flash write requests sent in current raid stripe. If it is
        equal to raid stripe size - 1:</p> <ul>
            <li id="d1e9972"><p>Send
            RAID page frame write request to the Write Manager.</p></li>

            <li id="d1e9978"><p>Increment RAID stripe pending
            completions.</p></li>

            <li id="d1e9984"><p>Mark
            RAID stripe state to WRITE_IN_PROGRESS</p></li>

            <li id="d1e9990"><p>Update
            active RAID stripe to next RAID stripe.</p></li>
          </ul></li>
      </ol></section>

    <section id="Processing_Flash_Completions_achta874fa"><title>Processing Flash Completions</title> <ol>
        <li id="d1e10008"><p>Check for
        flash write errors. If there is no flash write error:</p> <ul>
            <li id="d1e10015"><p>Release data frame buffer.</p></li>

            <li id="d1e10021"><p>Obsolete old lookup table entry if it is
            valid.</p></li>

            <li id="d1e10027"><p>Update
            lookup table entry.</p></li>

            <li id="d1e10033"><p>Send
            write completion.</p></li>
          </ul></li>

        <li id="d1e10041"><p>If there
        is a write error:</p> <ul>
            <li id="d1e10048"><p>Mark
            logical target with write error and set write error in RAID stripe
            structure.</p></li>

            <li id="d1e10054"><p>Set
            RAID stripe page number to max page number of flash
            block.</p></li>

            <li id="d1e10060"><p>New
            flash address is assigned to the data frames in failed page
            frame.</p></li>
          </ul></li>

        <li id="d1e10068"><p>Decrement
        RAID stripe pending completion count. If it is zero:</p> <ul>
            <li id="d1e10075"><p>Update
            next RAID target.</p></li>

            <li id="d1e10081"><p>Set
            RAID stripe active logical target to first logical target of RAID
            stripe.</p></li>
          </ul></li>

        <li id="d1e10089"><p>If RAID
        stripe page number is equal to max page number of flash block and
        pending completion count is zero:</p> <ul>
            <li id="d1e10096"><p>Set
            logical target state to waiting for new flash block.</p></li>

            <li id="d1e10102"><p>Send
            RAID stripe block open request (separate block open request every
            logical target of RAID stripe) to the Wearleveling
            Manager.</p></li>
          </ul></li>
      </ol></section>

    <section id="When_Timer_Expired_adhta874fa"><title>When
    Timer Expired</title> <ol>
        <li id="d1e10119"><p>Send page
        frame write request to the Write Manager.</p></li>

        <li id="d1e10125"><p>Increment
        RAID stripe pending completions.</p></li>

        <li id="d1e10131"><p>Increment
        page number.</p></li>

        <li id="d1e10137"><p>Set data
        frame number to zero.</p></li>

        <li id="d1e10143"><p>Update
        RAID stripe active logical target to next logical target.</p></li>

        <li id="d1e10150"><p>Increment
        number of flash write requests sent in current RAID stripe. If it is
        equal to RAID stripe size - 1,</p> <ul>
            <li id="d1e10157"><p>Send
            RAID page frame write request to the Write Manager.</p></li>

            <li id="d1e10163"><p>Increment RAID stripe pending
            completions.</p></li>

            <li id="d1e10169"><p>Mark
            RAID stripe state to WRITE_IN_PROGRESS</p></li>

            <li id="d1e10175"><p>Update
            active RAID stripe to next RAID stripe.</p></li>
          </ul></li>
      </ol></section>
  </body>
</topic>