<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA 1.2 Topic//EN" "/SysSchema/dita/dtd/technicalContent/dtd/topic.dtd">
<topic xmlns:ditaarch="http://dita.oasis-open.org/architecture/2005/" base="Princeton" id="FlushReq_8qhta874f6" xml:lang="en-US">
  <title>FlushReq</title>

  <body>
    <p>The Flush Request indicates the host has issued a
    reset or the system is going down. The Lookup Manager waits for all
    pending IO requests to be completed and saves system data to the snapshot
    section.</p>

    <fig id="Flush_Request_Control_Flow_8rhta874f6">
      <title>Flush Request Control Flow</title>

      <image href="../../Graphics/Lookup_Mgr/FlushReq.svg" placement="break" width="5.5in"/>
    </fig>

    <table id="_8shta874f6">
      <title>Flush Request Control Flow</title>

      <tgroup cols="3">
        <colspec colname="c1" colwidth="5*"/>

        <colspec colname="c2" colwidth="23*"/>

        <colspec colname="c3" colwidth="72*"/>

        <thead>
          <row>
            <entry>No.</entry>

            <entry>Message</entry>

            <entry>Description</entry>
          </row>
        </thead>

        <tbody>
          <row>
            <entry><p> <b otherprops="bold">1</b> </p></entry>

            <entry><p> <b otherprops="bold">CmdReady64</b>
            </p></entry>

            <entry><p>The command is
            received by one of the Data Managers.</p></entry>
          </row>

          <row>
            <entry><p> <b otherprops="bold">2</b> </p></entry>

            <entry><p> <b otherprops="bold">CmdReady</b>
            </p></entry>

            <entry><p>The Data
            Manager forwards the command to the Admin Command Manager for
            processing.</p></entry>
          </row>

          <row>
            <entry><p> <b otherprops="bold">3</b> </p></entry>

            <entry><p> <b otherprops="bold">WriteLockReq</b>
            </p></entry>

            <entry><p>The Admin
            Command Manager sends a write lock request for the LBA range for
            the specified namespace ID.</p></entry>
          </row>

          <row>
            <entry><p> <b otherprops="bold">4</b> </p></entry>

            <entry><p> <b otherprops="bold">LockCpl</b>
            </p></entry>

            <entry><p>The Locking
            Manager responds with a lock completion message when the lock is
            granted.</p></entry>
          </row>

          <row>
            <entry><p> <b otherprops="bold">5</b> </p></entry>

            <entry><p> <b otherprops="bold">FlushReq</b>
            </p></entry>

            <entry><p>The Admin
            Command Manager issues a flush requests to Lookup Manager
            0.</p></entry>
          </row>

          <row>
            <entry><p> <b otherprops="bold">6</b> </p></entry>

            <entry><p> <b otherprops="bold">GCCtrlReq</b>
            </p></entry>

            <entry><p>The Lookup
            Manager issues a GCCtrl request to the Wearleveling Managers to
            pause garbage collection.</p></entry>
          </row>

          <row>
            <entry><p> <b otherprops="bold">7</b> </p></entry>

            <entry><p> <b otherprops="bold">GCCtrlCpl</b>
            </p></entry>

            <entry><p>The
            Wearleveling Managers respond with GCCtrl completion message to
            Lookup Manager 0.</p></entry>
          </row>

          <row>
            <entry/>

            <entry/>

            <entry><p>Lookup Manager
            0 waits for all outstanding write requests to be completed and
            sends flush request to the Lookup Manager 1. </p></entry>
          </row>

          <row>
            <entry><p> <b otherprops="bold">8</b> </p></entry>

            <entry><p> <b otherprops="bold">FlushReq</b>
            </p></entry>

            <entry><p>The Lookup
            Manager 0 issues a flush request to the Write Manager</p></entry>
          </row>

          <row>
            <entry><p> <b otherprops="bold">9</b> </p></entry>

            <entry><p> <b otherprops="bold">WriteSnapshotReq</b>
            </p></entry>

            <entry><p>The Write
            Manager issues a write snapshot request to the Journal
            Manager</p></entry>
          </row>

          <row>
            <entry><p> <b otherprops="bold">10</b> </p></entry>

            <entry><p> <b otherprops="bold">WriteSnapshotCpl</b>
            </p></entry>

            <entry><p>The Journal
            Manager saves system data and sends <b otherprops="bold">WriteSnapshotCpl</b> message to the Write
            Manager.</p></entry>
          </row>

          <row>
            <entry><p> <b otherprops="bold">11</b> </p></entry>

            <entry><p> <b otherprops="bold">FlushCpl</b>
            </p></entry>

            <entry><p>The Write
            Manager saves a sequence number to the superblock and sends a
            flushCpl message to Lookup Manager 0.</p></entry>
          </row>

          <row>
            <entry><p> <b otherprops="bold">12</b> </p></entry>

            <entry><p> <b otherprops="bold">FlushCpl</b>
            </p></entry>

            <entry><p>The Lookup
            Manager 0 sends flush completion message to the Admin
            Manager.</p></entry>
          </row>

          <row>
            <entry><p> <b otherprops="bold">13</b> </p></entry>

            <entry><p> <b otherprops="bold">LockRelease</b>
            </p></entry>

            <entry><p>The Admin
            Command Manager releases the LBA write lock.</p></entry>
          </row>

          <row>
            <entry><p> <b otherprops="bold">14</b> </p></entry>

            <entry><p> <b otherprops="bold">CplQueueUpdate</b>
            </p></entry>

            <entry><p>The Admin
            Command Manager sends a completion queue update request to the
            Completion Manager.</p></entry>
          </row>

          <row>
            <entry><p> <b otherprops="bold">15</b> </p></entry>

            <entry><p> <b otherprops="bold">CplQueueUpdateCpl</b>
            </p></entry>

            <entry><p>The Completion
            Manager replies back to the Admin Command Manager when the
            completion has been successfully sent to the host.</p></entry>
          </row>
        </tbody>
      </tgroup>
    </table>
  </body>
</topic>