<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA 1.2 Topic//EN" "/SysSchema/dita/dtd/technicalContent/dtd/topic.dtd">
<topic xmlns:ditaarch="http://dita.oasis-open.org/architecture/2005/" base="Princeton" id="Firmware_Activate_zht97qqbl" xml:lang="en-US">
  <title>Firmware Activate</title>

  <body>
    <p>The Firmware Activate command is used to verify that
    a valid firmware image has been downloaded and to commit that revision to
    a specific firmware slot. The host may select the firmware image to
    activate on the next controller reset (CC.EN transitions from ‘1’ to ‘0’,
    a PCI function level reset, and/or other controller reset) as part of this
    command. The currently executing firmware revision may be determined from
    the Firmware Revision field of the Identify Controller data structure or
    as indicated in the Firmware Slot Information log page.</p>

    <fig id="NVM_Express_Firmware_Activate_Command_Co_10ht97qqbl">
      <title>NVM Express Firmware Activate Command
      Control Flow</title>

      <image href="Graphics/Admin Command Manager/Firmware_Activate.svg" placement="break" width="5.5in"/>
    </fig>

    <table id="_11ht97qqbl">
      <title>NVM Express Firmware Activate Command
      Control Flow</title>

      <tgroup cols="3">
        <colspec colname="c1" colwidth="5*"/>

        <colspec colname="c2" colwidth="23*"/>

        <colspec colname="c3" colwidth="72*"/>

        <thead>
          <row>
            <entry>No.</entry>

            <entry>Message</entry>

            <entry>Description</entry>
          </row>
        </thead>

        <tbody>
          <row>
            <entry><p> <b otherprops="bold">1</b> </p></entry>

            <entry><p> <cmdname otherprops="bold">CmdReady64</cmdname>
            </p></entry>

            <entry><p>The command is
            received by one of the Data Managers.</p></entry>
          </row>

          <row>
            <entry><p> <b otherprops="bold">2</b> </p></entry>

            <entry><p> <cmdname otherprops="bold">CmdReady</cmdname>
            </p></entry>

            <entry><p>The Data
            Manager forwards the command to the Admin Command Manager for
            processing.</p></entry>
          </row>

          <row>
            <entry><p> <b otherprops="bold">-</b> </p></entry>

            <entry><p> <b otherprops="bold">-</b> </p></entry>

            <entry><p>The Admin
            Command Manager performs a Flush (Internal) to ensure that all
            outstanding requests have been serviced before starting to write
            the new firmware image to flash.</p></entry>
          </row>

          <row>
            <entry><p> <b otherprops="bold">-</b> </p></entry>

            <entry><p> <b otherprops="bold">-</b> </p></entry>

            <entry><p>The Admin
            Command Manager performs a CRC checking on the firmware image in
            the controller memory.</p></entry>
          </row>

          <row>
            <entry><p> <b otherprops="bold">3</b> </p></entry>

            <entry><p> <cmdname otherprops="bold">FwUpdtReq</cmdname>
            </p></entry>

            <entry><p>The Admin
            Command Manager sends the Control manager the request to save off
            the firmware into the meta partition and update the superblock
            information.</p></entry>
          </row>

          <row>
            <entry><p> <b otherprops="bold">-</b> </p></entry>

            <entry><p> <b otherprops="bold">-</b> </p></entry>

            <entry><p>The Control
            Manager confirms the CRC on the firmware image stored in
            controller memory and, assuming the CRC is good, issues flash
            write requests to save the firmware in to the specified firmware
            slot.</p></entry>
          </row>

          <row>
            <entry><p> <b otherprops="bold">4</b> </p></entry>

            <entry><p> <cmdname otherprops="bold">FlashWrite</cmdname>
            </p></entry>

            <entry><p>The Control
            Manager issues flash write requests.</p></entry>
          </row>

          <row>
            <entry><p> <b otherprops="bold">5</b> </p></entry>

            <entry><p> <cmdname otherprops="bold">FlashOpCpl</cmdname>
            </p></entry>

            <entry><p>The Flash
            Interface responds to the flash write requests.</p></entry>
          </row>

          <row>
            <entry><p> <b otherprops="bold">6</b> </p></entry>

            <entry><p> <cmdname otherprops="bold">FwUpdtCpl</cmdname>
            </p></entry>

            <entry><p>The Control
            Manager responds back if the operation was successful.</p></entry>
          </row>

          <row>
            <entry><p> <b otherprops="bold">-</b> </p></entry>

            <entry><p> <b otherprops="bold">-</b> </p></entry>

            <entry><p>The Admin
            Manager updates the firmware slot information in log page ox03
            (Stored in the controller memory).</p></entry>
          </row>

          <row>
            <entry><p> <b otherprops="bold">7</b> </p></entry>

            <entry><p> <cmdname otherprops="bold">PMWriteReq</cmdname>
            </p></entry>

            <entry><p>The Admin
            Command Manager issues a request to write the updated firmware
            slot information to Mapping Manager 0.</p></entry>
          </row>

          <row>
            <entry><p> <b otherprops="bold">8</b> </p></entry>

            <entry><p> <cmdname otherprops="bold">PMOpCpl</cmdname>
            </p></entry>

            <entry><p>Once the
            information has been saved, Mapping Manager 0 replies with a
            completion message.</p></entry>
          </row>

          <row>
            <entry><p> <b otherprops="bold">9</b> </p></entry>

            <entry><p> <cmdname otherprops="bold">CplQueueUpdate</cmdname> </p></entry>

            <entry><p>The Admin
            Command Manager sends a completion queue update request to the
            Completion Manager.</p></entry>
          </row>

          <row>
            <entry><p> <b otherprops="bold">10</b> </p></entry>

            <entry><p> <cmdname otherprops="bold">CplQueueUpdateCpl</cmdname> </p></entry>

            <entry><p>The Completion
            Manager replies back to the Admin Command Manager when the
            completion has been successfully sent to the host.</p></entry>
          </row>
        </tbody>
      </tgroup>
    </table>
  </body>
</topic>